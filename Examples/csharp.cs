//YYJJYY5PG&@@@&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@&BBG#B&G#BBBPPPPPGB#&&#BP5YYYYYYYYYYYYYYYYYY5YYYJJJJ??7777!!!7??~^~!~77!!!!7!!7!!77!77??J???77?77!!~~^^^::::^^^^^^^^:^^:::::::::^^:::~!!!!!!!7JJ5PY?77!!^^^^^^^~~^^^~7?7!!!!!!!!!7JJJYJ?77!^^^:::^~^~^^!!7?
//YJJJJYY5PPB#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#&#&#&@&######BGGP5555YYYYJJJJJJJJYYY55P55YJJJJ??7YJ?7!!!!!!~~~~^^^^^~~~~~!!!!!!!!!777!???JJJJJJ???77!!~~^^::::::::::::::::::::::::^^~~~~~~!!!!!!!!!!~^^^^^^^^^^~7!!!!!!!~!!!??JJJ??77!~^^::::^~^~~~!7??
//J?JJYJJJY5PPB&@@@@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#BGP5555555YYYJJJJY5555PPPPPPP555YYYYJ?7!?5J?77!!7?7~~~!~^^^^!^^^^~!!!!!~~!!!!!!!!!!7777????JJ????77!^:^^^::::::......:::....:::^~~!~~~~~~~^~^^^^^^^^^~!!!!!!!!~!!!?JJJJ?77!!~:^:::::^~^^~7????
//??JJJYYJJJ5PPB&###&&#&#BGG#@@@@@@@@@@@@@@@@@@@@@@@@@@&##BGPP5555YYYYYYYJJJJJYGPGPPPP555PP5YYJJJJJJJ77YY?7!~~~!?!!!~7?~^^~^^~!~~^^~~!!!!!~~~~~~~~~~~~~~~!!777777!^:!!!!~~~~^^^::::::.:::::...:::^^~~~~^~^^^^^^^^^^^^^~~~~~~~!7JJJJ?77!!!!^::::::.:~^~!7??77
//????JJYYYJJ5PPGGPGGB#&&#BB#&&&@@@@@@@@@@@@@@@@@@@&#BGGPPPPP555Y5YYYYYYYYYYYJY55P555YJ??JYYJJJ???????77J7!!~~~!!7!!77?7777777!7!~^:::::::^^~~!!~^^^^~~~~::^^^^^~^^~~~^^^^^^^^^^^^^^:::::::::::::::::^^^~~^^^^^^:^^^^^^^~~~!7?JJJJ?77!!!!~:::....:!!^^~!!!~~
//???7?JJJYJJJ5PGGGPGGGGGGGB#BGBB##&&@@@@@@@@@@&#BGGPPPPPP555555Y555YY55555555YYYJJ????????JJ????????????77777777777777?J?????777777!!~^^::..:::^^~^^^^^^::::::::^^^^^^^^^^^^^^^^^^^^:^^^^:^^^^::::::::::~:^^^^^^^^:^~~~~~7?JJJJ??77!!!!!^::::~!?JYY!^~~~~~~
//???777??JJJJY5GGPPPGGGGGGGPPGGGGGGGGGBBB#&#BGGPPPPPP5555555YYYYYJJJJJY5P5YYJJJJ??7??JJ?????JJJJJJJJJJJJ??????7777!!!!!7777777777?????!^^:::::::::^~~:^~~~^::........:::^^^^^^^^^:::::::::^:::::::::::::::^~~~^^^^^:^~!7JJJYYJ?77!!!!!!!^:::^~~~~~^::::::::
//?7????????JJ555GPPPPP5YYY55555555555PPPGGPPPPPPPPP55555YYYYYYJJJJJJJJJ55???????7777777777?5P5YYJJJJJJ????777!!!!!!!!!!~!!!!!!!77777???7~^::^:::::::...:^~!!77!!~^:::......::::^^^^^::::::..:::::::::::::::^^~~~^^^~!?YYY5PPY?7!!!!!!!!~::...........::::::
//??7?J?JJJJJJJYY5PPPPP5YYYYYYYY555555PPP5PPPP555P555555YY555555YJ??????J?7????77777777777!JPPPP55YJJ??777!!!!!!~~~~~~^^~!J?~!!~!!!!!!7777!!!!!^^^~^^::::..:^:~!!7!^:!?7!~~^::..:::::::^^^^::::::::::::::::::::::~7?JYY55PPY?7!!!!!!!!!!~::..::::::::^^!!!!!
//???7?????????YYJYPPPPPYJJJYYYYYYY5PGPP55555555555YYYYYY5555PPP55YYJ????????777777777?7777JJY5555555YJ?777!!!!!!~~~~~^~~!Y?^!~~!77!~~~~~^~~~~~!~~77!!~:::::::.:^~!~::~~~!7?J!!^^^~::::^^::::^^^^::^^~~::::::^~7?JYYY5P5YJ7!!!!!!!!!!!!!~:::^^~~^^^^^^^~!!!!
//????7???7777?JJ??J5PPP5JJJJJJJY5G##BP555Y555555YYYYYY5555555YYYYYYYJJ????77?JJ??7??J?77!?J???JJJJYJ?!!77777!!!~~~^^^^^^~!^^~^~!!?7!!!77!~^^^!!!!~!!^^::::.:^:.::^^^^7~..~!J^^^^.~^.::::^^::::^^^^^^:^~!!77??JYYY5P5YJ77!!!!!!!!!!!!!!!!~~~~~~~~~~~^^^~~~~^
//?????77????7?J?J???Y55P5YYYYYYPBB#BP5YYYYYY5555YJJJY5555YJJJJJJJJ??????7?JYJ?7777?77!!!!7????77?777!!!!~~~~~~~^^^^^^^::^!!^:^^~~!!?J5Y!~::::^~7?7!^:::...:^^::.::^~??7~!!!?^~^^:^^:::::::^:::::::^~!7????JYY55P55J?7!!!!!!!!!!!!!!!!!!!!~~~~~~~~~~~~~^^^^^
//??????777????J7??77?Y555555PGGBBBBG5Y55YYYJYYYYJJJJJJYJJJJ????????777777?????77!!!!!!!7!!!!!!!7??!!77!~~~~^^^^^^^::::::::^::^^^^!!~?J^~~^::^^~~~!~^:....::^^^^~!7777777!!777???7~7Y:::~~^:::::^~7????JJJYY5PP5J?7!!!!!!!!!!!!!!!!!!!!!!!~~~~~~!~~~~~^^^^^^
//?????????777?J?7??????????YGGGGGGGPPP55YYYYYJ??J?????JJ??????77777777!!77?77!!!!77!!!~!??777777!!!~77~~!!!!~~^^^^:^^::::::::::^^!!^^::!?!^^::^^^^^^:.....:~777?777777777!!!7777!^^!::::^^~~~!7????JJYYY5PPYJ?77!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~~^^^^^^^^
//???????????7777777777777?YGG5555PPPP555555JJ??????J??????7777777777!!!!7!!!7!77!!!!~~7JYYY?7!7!~^~~~~~~~~~~~~!!!^^^^::::::::::::::^:.:!7~^^:::::::..~~^~777777777777777!!!!!!777!!~~^^!!77?????JJYYY55P5J?77!!!!!!!!!!!!7!!!!!!!!!!!!!!!!!~~~~~^^^^^^^^^^^
//?????????????7777777777?5GGGGP5PPPPYY55YJ??JYJJ???7777777777!!777!!!!!!!!!!!7777!!~~~77?Y5Y?7!7?!!~^^^:::::^!!~^^^::^^^^^^^^^^:::::^~!~^::::::::....~77777777777777!!!!!!!77!!~~~~~!~!???7??JJYYYYYYYJ?7!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~^^^^^^^^^^^^^
//???????????????????????5PPBGPPPPPY?J5PP5YJJJYYYYYJJ?7777!!!!!77!7????JJJJJJJJJJJ??7777!7?J?777!777!~!7~~^::^~~~~~~~~~~~~~!~~^^^^^^~!!^^:::::::.....:^~!!7?J?77?77!!!!!7777777~^~~!!7??7??JJYYJJJJ??77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~^^^^^^^^^^^^^^^^^
//JJJJJ?????????????7???5PPPPPPP5J?7J5PPPPP55YYYYJJJY55Y?777!!7?7?J?77!!!!!7777777!!!!!!!!!!!!!!~~~~~~!~!!~~~~~~~~^^~~~~~~!!~^^^^^^!?7!~~~!~::.....:.:::^^~!7???JJJ??777777!!~^^^77?7???JJJJYJ??7777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~^^^^^^^^^^^^^^^^^^^^
//??????????????777777?PGPP5PP5J77?Y5PPPPPPP555YYYJJJJJJJJ??JJ?777!!!~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^~^^^^^^^^^^::.........:::^^^~!77??JJ7~~~!^^~777777??JJJJJJ??777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~^^^^^^^^^^^^^^^^^^^^^^^
//???????????7777777?YPPPPYJ5Y?7?JY55555PP555555YYYYJJJJJJJJY7!!!!!!!~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^:::::::::::::::::::::::::::::::^^^^^::............::^^^^~!!!~~~~!!7?77???JJJJJ??7777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~^~7~^^^^^^^^^^^^^^^^^^^^^^
//???????????7777???Y55PPP5YYYYJJYY55555555555JJJYJ??JJJJJJJ5?~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^~~~~~~^^^^^^^^^^^::::::::::::::::~!!~^^^^^^^:::^~!~::^^^:...::..::::::^~~!7???77??JJJJJJ??7777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~7JYY~^^^^^^^^^^^^^^^^^^^^^^
//?????????????????JYYY5GGP5YYYYYYYYYY5555555?!7!7!!JYYJ7?J55!~~~~~~~~~~~~~~~~~~~~~^^^^^^~~~~~~~~~~~~~~~~~~~!^::::......::^^^^^^::::^^^^^^^::^!!^~!!!~^^^:.::::~!!7????77???JJJJ???777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~!JYYJ7~~^^^^^^^^^^^^^^^^^^^^^^
//?????????????????YYYY?YGPP5YYYYYYYJYYY55555?!!!?JJYJ?7!J5Y7~~~~~!!!~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~!~::::::.....:~!~^^^:::::^^^^^^^^^^^!!~^^^^^::::^^^7?JJ??77??JJJJJJ?7777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~!7!!!!!~^^^^^^^^^^^^^^^^^^^^^^
//????????????????YYYYJ77J5JJ55YYYYYYJJYYYY55Y7!7Y5?!!!!?J???7!!~!!~~~~~~!!~~~~^^^^^^^^^^^^~~~~~~~~~~~~~~~~~^::::::.....!??77!~^^^^^^^^^^^^^^^^~~~^:::::::::^~7??77??JJJJJJJ?7777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~^^~~!!^^^^^^^^^^^^^^^^^^^^^^^^^
//7???????????????YYYYJ?77?YJYP5YYYYYYYYJJYYYJ~~!JJ~~!!~~7JJJJ?77!!~~~~^~~~~!!!!!!~~~^^^^^^^^^~^^^^^^~~~~~~^::::::.....~?????77!~^^^^^^^^^^^^~~~^::::::::^~7??77??JJJJJJJ??77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~^!7!!^^^^^^^^^^^^^^^^^^^^^^^^^:^
//???????????????JYYYYJ?777?5GYJ55YJJJJ???7??~~!?J7!!~~~~~!7?J?????7!~~~~~!!~~~~~!!!!!!~~~~~~~~~~~~~^^^^~~^:::::::.::.~???????77!~^^::^^^^~!7~~^:...:^^~7???7??JJJJJYJJ?77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~^^~^^^^^^^^^^^^^^^^^^^^^^^^^::^~~
//???????????????YYY555?7?7?7JPPJJJ7!!!7JJJ!~~~7J?7~~~~~~~~!!7????????7777!7!!~~~~^^~~~~~~^^^^^^^^^^^^^^!~::::::::::.^?J?????777!!~^^^~~~^^^^:::...:~7???7???JJJJYYJ?777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^::::^^~~^^
//???????????????5YPGGG5???????Y5YYJ?77?J?7~!777!~~~~~~~~~~!!!!!7??77?777?????77!~^^~^^^^^^^^^^^^^^^:::^^^:::::::::.:7JJ?????7777!~!!~~^:..::..:^~7??77???JJJJYYJJ?77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~~^^^^^^^^^^^^^^^^^^^^:::::^~~~^:::
//???????????????PPGGBBPY???PB#B5YP5JJ?77!777!~^^~~~~~^^^^~~!!77!!?JJJ?JJJJ??????7!!~!!7!~~^^^^:^^^^^^^^^^::::::::::7JJJ???7777!!!7?7~:::!?JYJ77??77???JJJJYYJJ?777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~~~~^^^^^^^^^^^^^^^^^^:::::^~~^^:::::
//???????????????PBGBBBGGP?YP#&##5??Y5J??JJJ??7~~^^^^~~~^^^^^~!7?JYJJJJJJJJJJJJJJJJ?7~~!!~^^^~77~!~~~~~~~~~~^^^^:::^7??????77!!!!!7!^:^~?YYYJ???7???JJJJJYYY?777!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^::::^^^^^:::::^^^
//????????????JJJJGBBGBBGGPJPB&#&GY7!??JJ??JJJJ?7!^^^^^~~~~^^~?JYYYJJJJJJ?77?JJJJ?7~^^^~~~^^^~~!!?????777??J?7777~^^^^^!?77!~~~~^^:::^!????777???JJJJJYYYJ?77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^:::::^^^^:::::::^^^^
//????????JJJJJJJJ5BGPGGBGPPPPPG&&PJ7!!77?JJJJJJJ??!~^^^^~~!?JJJJJJJJJJ77!!7?JJ?!~^^~~^^~~~~~~~~~!!!!!!~~~!7!!7??7!^^^^^^^~^^^::::^~7?7777????JJJJJYYY5Y?77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~^^~^^^:::::::^^^^^^^^^^^^^^^^^^:::^^^^:::::::^^^^^^~
//????????JJJJJJJJJP#BGGGGGPP5PPG&GJ77!!!!!7?JJJ?JJ???!~^~7JJJJJJJJJJJ????????!^^^^^^^^~~~!!~~^^^^~~~^^^~~~~~~~!~~~~^^^^~~^^^^::~!~~!77????JJJJJYYYYYY?77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~~^^^^::..........:^^^^^^^^^^^^^:::^^^^::::::::^^^^^~~~^
//???????JJ?JJJJJJYJPBBGGGGGPPPP55Y!~!!!!!!!!!7?JJ???????JJ??????JJJJJJJJJ?!~~^^~~~!!!!!!?JJY?^^^^^^::^^^^~^^~~!~^~!777???77?!~!~!77???JJJJJJYYYY5YJ77!!!!!!!!!!~~~~!!!!!!!!!!!!!!!!!!!!!!!!!!!!~~~^^^^:...............:^^^^^^^^^^:::^^^:::::::::^^^^^^~~~~~
//??J???JJJJJJJJJ5&5J5BBGGGGBPPP5?7!!!!!!!!!~~~~~777?77?777!!!!7!7??JJJJ7!~^^~~!!7??JJYYYYJJ??777!!!!!~~~~~~^^~~~^~~~!!!!7!~!7?777??JJJJJYYYYY5YJ?777!!!!!!!!!~~~~~~~!!!!!!!!!!!!!!!!!!!!!!!!~~~^^^^:..................:^^^^^^^^:::^^:::::::::^^^^^^^^^^~~~~
//J?JJJJJJJJ?JJJJ5&&PJYGBBGGGGGP5PYJ7!!!!!!!~~!~^~!!7?!~!!??7!77??777?7!~!!!77?JY5PPPP5555YYJJJJJJJ??????77777!!!!!!!!!!~~~~!???JJJJJYYYYYYYYJJ7777!!!!!!!!!~~~~~~~~~!!!!!!!!!!!!!!!!!!!!!!~~^^^^::::^^^^:^::..........:^^^^^^^^^^^:::::::^^^^^^~~~~~~~~~!~~
//JJJ??JJJJJJ???JJPBB5JJPBBGGGGGPP5PY7!!!!!!!!~~~~~^~~~77??7?JYYYYJ?77!7JY55555PGGBBBGGPYYJJJYYYYYYYYJJJJJJYYYYJ????777?777???JJJJJYYYJJJJ?77!!!~~~^^:~!!!~~~~~~~~!!!!!!!!!!!!!!!!!!!!!!!~~^^^^^^^:::......::::.......::^^^^^^^^::.:::::^^^^^^^~~~~~~~!~~~!~
//??J????J????J?JJYPGBGYJYPBBGGGGGP555J?7!!~!~~~~~^~~~^^!7?JJJJ???JJJJ?JYYYY55PGPGGGB#BBG5555555555YYYYYY55PBBGP5YYJJJ????????????77????7!!!!~~~^~~::^~!!~~~~~~~~~!!!!!!!!!!!!!!!!!!!!!~~^^^^^^:......::.....:^.......:^^^^^^^::::::^^^^^^~~~~~~~~~~~~~~~~~~
//???????JJJJJJ??JJY5P#BYJJYPGGGPGGGPPP5PJ!!!~^~~~~~^^~7JYJJ?????7???!!~~~~7YYPYYPYYYG#BB#GGGGPPP5555YYYYY55PPGPPPPYYY??????JJJJYYY5555J????77!!~7^::~!~~~~~~~~~~~~!!!!!!!!!!!!!!!!!!~~^^^~~^:......:::..:::..::.....::^^^~^::::::^^^^^^~~~~~~~~~~~~~~~~!~~!
//?????????????????JY5PBB5J?JY55PPPPGGGPP5Y?7!~~~^^~!?J?7777?????7!~^^^~~~~?J?JJJJJ??J5##&&PPP5555555Y55555555Y5GB#B555YYY55GPPP5555J???????7!^~7^::~!~~~~~~~~~~~~~!!!!!!!!!!!!!!!!~~^^^~~^:.......:::..::.....:....::^~~^::::^^^^^^^~~~~~~~~~~~~!!!!!!!!~~!
//J?????????????????JYY5PP5J??JJY55555PGGGP555Y7!!7?J?7!!!!!!!~~!~^^^~~~~~^?P?7?JJJJJJJP#B#G??JJJY5P55JY5P5PG55Y5#&@BYJJJY5P5JJJY55Y77!!7?Y?7~~?^::~!~~~~~~~~~~~~~~~!!!!!!!!!!!!~~~^^^!!^:........:::..::......::..:^~~^::::^^^^^^^^~~~~~~~~~~!~!!~~~!!!!!!~
//???????????????????JY5YYYYYJ?JJJY55555PGGGGPY?????7!!!!!!~~~~~~!!!~~~^^^^7G5JJJJY??Y??YYYYJJ??7?JPYY?JJ55YJP5YJ5BBPJJJ?JYY7?YPGPY7!!!!?Y?7!~?^::~!~~~~~~~~~~~~~~~~!!!!!!!!!!~~~^^^~7~:..::.....::::.:.......:::.:^~^:::^^^^^^^^^~~~~~~~~~~~~~~~!!~!!~!~~!!
//????????????????????JJYYYYYJJJJ??JJY5PGGBG5P5J?77!!!!!!~~~!~~~~~~~~~~~~!!!G#BP5JJYJYJJ??77!777???YY7?5J777?55YJ?JJJ7!~!??J5GP5?777!!!?7!!~~~:::^!~~~~~~~~~~~~~~~~~~~~~!!~~~~~^^^^!!:..::......:::.::........::.:^^:::^^^^^^^~^~~~~~~~~~~~~~~~~~!!!!!~!~~~!
//???7?????????????????JY5YYYJ?????????YPGG5Y?77!!!!!!!~~!!~^^^^^~~~~~!!7???Y##GPYJJYJJJJ?!77?JJ?7~~~^!GBY!!??JPP5??7!~~7JPGPY????77777!!!!!^::^!~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^!~...:::::::::::..:.........:.:::::^^^^^^~~~~~~~~!~~~~~~~~~!!!!!!!!!!~~~!~
//???????7????7???77???JYYYYJJJ??7???777777777!!!!!!!~~~~^^^^^^^^^~~!777?77!!JP55PY?YJJYJ7?JY?7!~^^^~~^7GP?!7YYJ55???77?JPGP5YJJ?J??77777!^::^!!~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^:~!:...:::::.:::::.::...:::^:.::::::^^^^^~^^~~~~~~~~~~~~!!!~~~!!!~!!!!~!!!~!~
//???????????????????????YYJYY??!!7??77777777!!!!!!!!!!~^^^^^^^~!77777!~!~~~!!7JJJYY?JJJ?777~^^^^~~~^^^^!JP?77Y5YJ777!??PP5YJ?????77!!~^^^^~!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^::~~..:::.:::::::.......::^^^::::::^^^^^^^^~~~~~~~~~~~~!~!!!!!~!!!!!~~!!!!!!!!!
//???7??7?????????????????YYJYYY!!7777!!777!!!!!!!!!?J?7!!~~~!7777!~^^^^~^~~~~~~!YYJ?JJ?7~~~^~~~^^^^^^^^^~?JJ7JJ7~!!!?????J?77!!~~^^^^^~!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^::~^......::::^^:::^^::^^^^^::::::^^^^^^^~~~~~~~~~~~~!~~!~!~~!!~!!!!!!~!!!!!!!!~
//7???????????????????7????YYJYY?!!!!!!!!!!!!!!!!!!!!!77????7!!~~^^^^^^^^^^^^^^~~~~!777!~~~~~^^^^^^^^^~!~~~~!!!~~!7???7!~~~~~^^^^~~!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^:::~:.........^~~~::^!~~^^:::::::::^^^~~~~^~~~~~~~~~!~~~!~~~~~!~~!~~~~!!~~!!!!!!~!
//????????J???7?7?????77????Y5YY5J7!!!!!!!!!!!!!!!!!!!!!!!7J?7~^^^^^^^^^:^:^:^^^^^~!~~!~~~~^^^^^^^^~!???!~~!!~~~~!7!~^^^^^~~!!!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^::.:~:.........^~^~^........::::::::^^^^~~~~~~~~~~~~~~~!!!~~!~!~~~~~~~~~~!!~!!!!!!~!
//???????????J?????77?7??????Y5Y55YJ7!!!!!!!!!!!!!!!!!!!!!!!7??7!~^^^^^^^:::::::::^^^^^^^^^^^^^^^~7??!~~~^^^^^^^~~~!!!!!!!!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^::::~:.......:^:~~^^..........::::::^^~~~~~~~~~~!~~~!~~~!!!!!!!!~~~~~~~~~~!!~~!~!!~!!
//????????????????77?????7777?JY555YJ7!!!!!!!!!!!!!!!!!!!!!!~!7???7!~~^^^^^^^^^~~!777??7!~~^^^^^^~!~^^^^^~~!!!!!!7!!!!!!~~~!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^:::::~:.....::!?~::::......::::::.:::^~~~~~~~~!!~~!~~~!~!!!!!!!!!!!~!!~!!~~~!!!!!~~!!!!
//?????????77?????7?7777777777?JY5P5J?7!!!!!!!~~~~~~~~~~!!!!!!!!!!777777!!!!!!!!!!!!!!777777!!~~~~~~~!!!!!!!!!!!!!~~~~~~~~~~!~~~~~~~~~~~~~~^~~^~~~~~~~^^~~~~^^^^^^^^:::::^^......:^!!::::::.:::^^^^^^::::^~~~~~~~~!!!!!!~~~!~!!!!~!~!!~~~!~!~~!!!!!!~!!~!!!!
//???????7??7??77777!77777777777?JYP5?77!!!~~~~~~~~~~~~~~~~~~~~~~~~~~!!!!!!~~~~~~~~!!!~~~!!!!!!777!!!!!~~~~~~~~~~~~~~~~~~~~~!~~~~~~~~~~~~~^^^^^^^~~^^~^~^^^^^^^^^^^::::::~.....:^!!~:::::::::^^~!!~^::::^~~~~~~~~!~~~!!!!!!!!!!!!!!!~~~~!~~~!!~~!!!~~!!!~~~~
using System;
using System.Net.Http;
using System.Text.Json;
using System.Threading.Tasks;
/*
 * FoA Orion Secret Keys API
 * OrionKeys API - C# Usage Example
 */
class OrionKeys
{
    static readonly HttpClient client = new HttpClient();
    const string API_URL = "https://orionkeys-fgbwb0habgdrhyh4.canadacentral-01.azurewebsites.net/API/derive";

    static async Task<uint> DeriveKey(byte[] seed, string keyName)
    {
        // Format seed as hex string
        string seedHex = $"0x{seed[0]:X2},0x{seed[1]:X2},0x{seed[2]:X2}";
        string url = $"{API_URL}?seed={seedHex}&key={keyName}";

        // Send request
        HttpResponseMessage response = await client.GetAsync(url);
        response.EnsureSuccessStatusCode();

        // Parse JSON
        string json = await response.Content.ReadAsStringAsync();
        using JsonDocument doc = JsonDocument.Parse(json);
        JsonElement root = doc.RootElement;

        // Try different possible key names (case insensitive)
        if (root.TryGetProperty("responseUInt32", out JsonElement val) ||
            root.TryGetProperty("response", out val) ||
            root.TryGetProperty("key", out val))
        {
            return val.GetUInt32();
        }

        throw new Exception($"Could not find response in: {json}");
    }

    static byte[] UInt32ToBytes(uint value)
    {
        return new byte[] 
        {
            (byte)((value >> 24) & 0xFF),
            (byte)((value >> 16) & 0xFF),
            (byte)((value >> 8) & 0xFF),
            (byte)(value & 0xFF)
        };
    }

    static string BytesToHex(byte[] bytes)
    {
        return string.Join(" ", Array.ConvertAll(bytes, b => $"{b:X2}"));
    }

    static async Task Main()
    {
        Console.WriteLine("OrionKeys API - Simple C# Example\n");

        try
        {
            // Example 1: IPC (Instrument Cluster)
            Console.WriteLine("Example 1: IPC Security Access");
            Console.WriteLine("-".PadRight(50, '-'));

            byte[] seed1 = new byte[] { 0xAA, 0xBB, 0xCC };
            uint response1 = await DeriveKey(seed1, "IPC01");
            byte[] responseBytes1 = UInt32ToBytes(response1);

            Console.WriteLine($"Seed:     {BytesToHex(seed1)}");
            Console.WriteLine($"Response: 0x{response1:X8}");
            Console.WriteLine($"Bytes:    {BytesToHex(responseBytes1)}");
            Console.WriteLine($"UDS:      27 02 {BytesToHex(responseBytes1)}");
            Console.WriteLine();

            // Example 2: BEM Level 3
            Console.WriteLine("Example 2: BEM Level 3 Security Access");
            Console.WriteLine("-".PadRight(50, '-'));

            byte[] seed2 = new byte[] { 0x12, 0x34, 0x56 };
            uint response2 = await DeriveKey(seed2, "BEM03");
            byte[] responseBytes2 = UInt32ToBytes(response2);

            Console.WriteLine($"Seed:     {BytesToHex(seed2)}");
            Console.WriteLine($"Response: 0x{response2:X8}");
            Console.WriteLine($"Bytes:    {BytesToHex(responseBytes2)}");
            Console.WriteLine();

            // Example 3: Multiple ECUs
            Console.WriteLine("Example 3: Multiple ECUs");
            Console.WriteLine("-".PadRight(50, '-'));

            var ecus = new[]
            {
                (Key: "FDIM01", Seed: new byte[] { 0x11, 0x22, 0x33 }),
                (Key: "ACM01",  Seed: new byte[] { 0x44, 0x55, 0x66 }),
                (Key: "BPM01",  Seed: new byte[] { 0x77, 0x88, 0x99 })
            };

            foreach (var ecu in ecus)
            {
                uint resp = await DeriveKey(ecu.Seed, ecu.Key);
                Console.WriteLine($"{ecu.Key,-8} | Seed: {BytesToHex(ecu.Seed)} | Response: 0x{resp:X8}");
            }

            Console.WriteLine("\nDone!");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"\nError: {ex.Message}");
        }

        Console.WriteLine("\nPress any key to exit...");
        Console.ReadKey();
    }
}
